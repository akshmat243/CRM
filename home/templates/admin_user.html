{% extends 'base.html' %}
{% block content %}
{% load static %}



<div class="dashboard-main-body admin_dashboard">
  <div class="dash-title">Admin Users</div>


  <div class="col-xxl-12 pb-5">
    <div class="row gy-4">

      <!-- followUps start -->

      <div class="col-xxl-3 col-md-4 col-6">
        <!-- <a href="{% url 'admin_side_leads_record' 'total_upload_lead_tag' %}" style="display: block;"> -->
        <a href="{% url 'teamcustomer' 'pending_follow' %}" style="display: block;">
          <div class="desh-card h">
            <div class="desh-card-body">
              <div class="admin-icon">
                <iconify-icon icon="iconamoon:discount-fill" class="icon"></iconify-icon>
              </div>
              <div class="admin-title">Pending FollowUps: {{ total_pending_followup }}</div>

              <!-- <div id="active-user-chart" class="rounded-tooltip-value"></div> -->
            </div>
          </div>
        </a>


      </div>

      <div class="col-xxl-3 col-md-4 col-6">
        <a href="{% url 'teamcustomer' 'tommorrow_follow' %}" style="display: block;">
          <div class="desh-card">
            <div class="desh-card-body">
              <div class="admin-icon">
                <iconify-icon icon="iconamoon:discount-fill" class="icon"></iconify-icon>
              </div>
              <div class="admin-title"> Toworrow FollowUps : {{ total_tomorrow_followup }}</div>

              <!-- <div id="active-user-chart" class="remove-tooltip-title rounded-tooltip-value"></div> -->
            </div>
          </div>
        </a>
      </div>


      <div class="col-xxl-3 col-md-4 col-6">
        <a href="{% url 'teamcustomer' 'today_follow' %}" style="display: block;">
          <div class="desh-card">
            <div class="desh-card-body">
              <div class="admin-icon">
                <iconify-icon icon="iconamoon:discount-fill" class="icon"></iconify-icon>
              </div>
              <div class="admin-title"> Today FollowUps : {{ total_today_followup }} </div>

              <!-- <div id="active-user-chart" class="remove-tooltip-title rounded-tooltip-value"></div> -->
            </div>
          </div>

        </a>
      </div>
      <!-- followUps section end -->

      <div class="col-xxl-3 col-md-4 col-6">
        <a href="{% url 'admin_side_leads_record' 'total_upload_lead_tag' %}" style="display: block;">
          <div class="desh-card">
            <div class="desh-card-body">
              <div class="admin-icon">
                <iconify-icon icon="iconamoon:discount-fill" class="icon"></iconify-icon>
              </div>
              <div class="admin-title"> Upload Leads : {{ total_upload_leads }}</div>
              <!-- <div id="active-user-chart" class="remove-tooltip-title rounded-tooltip-value"></div> -->


            </div>
          </div>
        </a>
      </div>

      <div class="col-xxl-3 col-md-4 col-6">
        <a href="{% url 'admin_side_leads_record' 'total_upload_lead_tag' %}" style="display: block;">
          <div class="desh-card">
            <div class="desh-card-body">
              <div class="admin-icon">
                <iconify-icon icon="iconamoon:discount-fill" class="icon team_t_lead"></iconify-icon>
              </div>
              <div class="admin-title">Remaining Leads : {{total_left_leads}} </div>
              <!-- <div id="active-user-chart" class="remove-tooltip-title rounded-tooltip-value"></div> -->

            </div>
          </div>
        </a>
      </div>

      <div class="col-xxl-3 col-md-4 col-6">
        <a href="{% url 'admin_side_leads_record' 'total_assigned_lead_tag' %}" style="display: block;">
          <div class="desh-card">
            <div class="desh-card-body">
              <div class="admin-icon">
                <iconify-icon icon="iconamoon:discount-fill" class="icon total_lead"></iconify-icon>
              </div>

              <div class="admin-title"> Total Lead : {{ total_assign_leads}}</div>

              <!-- <div id="active-user-chart" class="remove-tooltip-title rounded-tooltip-value"></div> -->


            </div>
          </div>
        </a>
      </div>

      <div class="col-xxl-3 col-md-4 col-6">
        <a href="{% url 'admin_side_leads_record' 'total_visit_tag' %}" style="display: block;">
          <div class="desh-card">
            <div class="desh-card-body">
              <div class="admin-icon">
                <iconify-icon icon="iconamoon:discount-fill" class="icon total_visit"></iconify-icon>
              </div>
              <div class="admin-title">Total Visits : {{ total_visits}}</div>
              <!-- <div id="active-user-chart" class="remove-tooltip-title rounded-tooltip-value"></div> -->

            </div>
          </div>
        </a>
      </div>

      <div class="col-xxl-3 col-md-4 col-6">
        <a href="{% url 'admin_side_leads_record' 'total_interested_lead_tag' %}" style="display: block;">
          <div class="desh-card">
            <div class="desh-card-body">
              <div class="admin-icon">
                <iconify-icon icon="iconamoon:discount-fill" class="icon team_interented"></iconify-icon>
              </div>
              <div class="admin-title"> Interested : {{ total_interested }} </div>
              <!-- <div id="active-user-chart" class="remove-tooltip-title rounded-tooltip-value"></div> -->
            </div>
          </div>
        </a>
      </div>


      <div class="col-xxl-3 col-md-4 col-6">
        <a href="{% url 'admin_side_leads_record' 'total_not_interested_lead_tag' %}" style="display: block;">
          <div class="desh-card">
            <div class="desh-card-body">
              <div class="admin-icon">
                <iconify-icon icon="iconamoon:discount-fill" class="icon team_ntint"></iconify-icon>
              </div>
              <div class="admin-title">Not Interested : {{total_not_interested }}</div>
              <!-- <div id="active-user-chart" class="remove-tooltip-title rounded-tooltip-value"></div> -->


            </div>
          </div>
        </a>
      </div>

      <div class="col-xxl-3 col-md-4 col-6">
        <a href="{% url 'admin_side_leads_record' 'total_other_location_lead_tag' %}" style="display: block;">
          <div class="desh-card">
            <div class="desh-card-body">
              <div class="admin-icon">
                <iconify-icon icon="iconamoon:discount-fill" class="icon team_ltion"></iconify-icon>
              </div>
              <div class="admin-title">Other Location : {{total_other_location }}</div>
              <!-- <div id="active-user-chart" class="remove-tooltip-title rounded-tooltip-value"></div> -->


            </div>
          </div>
        </a>
      </div>

      <div class="col-xxl-3 col-md-4 col-6">
        <a href="{% url 'admin_side_leads_record' 'total_not_picked_lead_tag' %}" style="display: block;">
          <div class="desh-card">
            <div class="desh-card-body">
              <div class="admin-icon">
                <iconify-icon icon="iconamoon:discount-fill" class="icon team_ntpck"></iconify-icon>
              </div>

              <div class="admin-title">Not Picked : {{ total_not_picked}}</div>
              <!-- <div id="active-user-chart" class="remove-tooltip-title rounded-tooltip-value"></div> -->


            </div>
          </div>
        </a>
      </div>


    </div>
  </div>



  <div class="card h-100 p-0 radius-12">
    <div
      class="card-header border-bottom bg-base py-16 px-24 d-flex align-items-center flex-wrap gap-3 justify-content-between">
      <div class="d-flex align-items-center flex-wrap gap-3">
        <form class="navbar-search">
          <input type="text" id="searchInput" class="bg-base h-40-px w-100" name="search" placeholder="Search"
            onkeyup="searchTable()">
          <iconify-icon icon="ion:search-outline" class="icon"></iconify-icon>
        </form>
      </div>
      <a href="{% url 'admin_add' %}"
        class="btn  text-content text-sm btn-sm radius-8 d-flex align-items-center gap-2">
        <!-- <iconify-icon icon="ic:baseline-plus" class="icon text-xl line-height-1"></iconify-icon> -->
        Add Admin
      </a>
      <a href="{% url 'admin_add' %}"
        class="btn  user-icon text-sm btn-sm p-4 radius-8 d-flex align-items-center gap-2">
        <iconify-icon icon="ic:baseline-plus" class="icon text-xl line-height-1"></iconify-icon>
        <!-- Add Admin -->
      </a>
    </div>
    <button type="button" class="btn btn-success m-1" data-bs-toggle="modal" data-bs-target="#statusSuccessModal"
      hidden>Success Modal</button>
    {% if messages %}
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var myModal = new bootstrap.Modal(document.getElementById('statusSuccessModal'));
        myModal.show();
      });
    </script>
    {% endif %}
    <div class="card-body p-24">
      <div class="table-responsive scroll-sm">
        <!-- {% if messages %}
                            {% for message in messages %}
                                <div class="alert alert-success">
                                    {{ message }}
                                </div>
                            {% endfor %}
                        {% endif %} -->
        <table class="table bordered-table sm-table mb-0" id="myTable">
          <thead>
            <tr>
              <th>S.N.</th>
              <th>Name</th>
              <!-- <th>Email id</th> -->
              <th>Mobile No</th>
              {% comment %} <th>Admin id</th> {% endcomment %}
              {% comment %} <th>Status</th> {% endcomment %}
              <th>Created Date</th>
              <!-- <th>Updated Date</th> -->
             
              <th class="text-center">Active/Non-Active</th>
              <th>Edit Now</th>
              <!-- <th>Status</th> -->
            </tr>
          </thead>
          <tbody>
            {% for user in users %}
            <tr>
              <td>{{ forloop.counter}}</td>
              <td>{{user.name}}</td>
              <!-- <td>{{user.email}}</td> -->
              <td>{{user.mobile}}</td>
              <td>{{user.created_date|date:"d-M-Y"}}</td>
              <!-- <td>{{user.updated_date}}</td> -->
             

              <form method="post">
                {% csrf_token %}
                <td class="active_staff">
                  <div class="form-check form-switch  d-flex m-auto align-items-center justify-content-center">
                    <input type="text" name="user_type" value="admin" id="user_type_id" hidden>
                    <input class="form-check-input toggle-user-active" type="checkbox" role="switch"
                      id="flexSwitchCheckDefault" data-user-id="{{ user.id }}" {% if user.self_user.user_active %}
                      checked{% endif %}>
                  </div>
                </td>
              </form>

              <td><a class="btn  btn-sm" data-toggle="modal" data-target="#ModalLoginForm{{user.id}}"
                href="{% url 'editadmin' user.id%}">Edit</a></td>

              {% comment %} <td><a class="btn  btn-sm" data-toggle="modal"
                  data-target="#ModalLoginForm{{admin.id}}" href="#ModalLoginForm{{user.id}}">Edit</a></td> {%
              endcomment
              %}
              {% comment %} <td>{{user.admin_id}}</td> {% endcomment %}
              {% comment %} <td>{{userdata.status}}</td> {% endcomment %}
              {% comment %} <td><a class="btn  btn-sm" data-toggle="modal"
                  data-target="#ModalLoginForm{{user.id}}" href="{% url 'editadmin' user.id%}">Edit</a></td> {%
              endcomment
              %}


              {% comment %}
            <tr>
              <td>{{ user.name }}</td>
              <td><a href="tel:{{ user.call }}">{{ user.call }}</a></td>
              {% comment %} <td><a href="https://wa.me/">https://wa.me/tel:</a></td> {% endcomment %}
              {% comment %} <td><a href="https://wa.me/{{ user.call }}">https://wa.me/{{ user.call }}</a></td>
              <td>{{ user.send }}</td>
              <td>{{user.status}}</td> {% endcomment %}
              {% comment %} <td>
                <form action="{% url 'status_update' %}" method="POST">
                  {% csrf_token %}
                  {% comment %} <input type="hidden" name="leads"> {% endcomment %}
                  {% comment %} <input type="hidden" name="leads_id" value="{{ user.id }}">
                  <div class="dropdown">

                    <button class="btn  dropdown-toggle" aria-expanded="false" data-bs-toggle="dropdown"
                      type="button">{{ user.status }}&nbsp;</button>
                    <div class="dropdown-menu">
                      <button class="dropdown-item" type="submit" name="new_status" value="Leads">Leads</button>
                      <button class="dropdown-item" type="submit" name="new_status" value="Lost_Leads">Lost
                        Lead</button>
                      <button class="dropdown-item" type="submit" name="new_status" value="Customer">Coustomer</button>
                      <button class="dropdown-item" type="submit" name="new_status" value="Maybe">Maybe</button>

                    </div>
                  </div>
                </form>
              </td> {% endcomment %}
              {% comment %} <td class="text-center">
                <select name="status">
                  <option value="leads" {% if user.status=="leads" %}selected{% endif %}>Leads</option>
                  <option value="coustomer " {% if user.status=="coustomer" %}selected{% endif %}>Coustomer</option>
                  <option value="lost leads" {% if user.status=="lost lead" %}selected{% endif %}>Lost Lead</option>
                  <option value="maybe" {% if user.status=="maybe" %}selected{% endif %}>Maybe</option>
                </select>
              </td> {% endcomment %}
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
</div>









<!-- Your existing modal code -->
<div class="modal fade" id="statusSuccessModal" tabindex="-1" role="dialog" data-bs-backdrop="static"
  data-bs-keyboard="false">
  <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-body text-center p-lg-4">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 130.2 130.2">
          <circle class="path circle" fill="none" stroke="#198754" stroke-width="6" stroke-miterlimit="10" cx="65.1"
            cy="65.1" r="62.1" />
          <polyline class="path check" fill="none" stroke="#198754" stroke-width="6" stroke-linecap="round"
            stroke-miterlimit="10" points="100.2,40.2 51.5,88.8 29.8,67.5 " />
        </svg>
        <h4 class="text-success mt-3">Oh Yeah!</h4>
        <p class="mt-3"> {% for message in messages %}
          {{ message }}
          {% endfor %}</p>
        <button type="button" class="btn btn-sm mt-3 btn-success" data-bs-dismiss="modal">Ok</button>
      </div>
    </div>
  </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
  $(document).ready(function () {
    $('.toggle-user-active').change(function () {
      var userId = $(this).data('user-id');
      var isActive = $(this).is(':checked');
      var userType = $('#user_type_id').val();

      $.ajax({
        url: '{% url "toggle_user_active" %}',
        type: 'POST',
        data: {
          'user_id': userId,
          'is_active': isActive,
          'user_type': userType,
          'csrfmiddlewaretoken': '{{ csrf_token }}'
        },
        success: function (response) {
          if (response.status === 'success') {
            alert('User active status updated successfully');
          } else {
            alert('Failed to update user active status');
          }
        },
        error: function (xhr, errmsg, err) {
          console.log(xhr.status + ": " + xhr.responseText);
        }
      });
    });
  });
</script>

<script>
  function searchTable() {
    var input, filter, table, tr, td, i, txtValue;
    input = document.getElementById("searchInput");
    filter = input.value.toUpperCase();
    table = document.getElementById("myTable");
    tr = table.getElementsByTagName("tr");

    // Loop through all table rows, and hide those that don't match the search query
    for (i = 0; i < tr.length; i++) {
      var rowShouldBeVisible = false;

      // Loop through all cells of current row
      for (j = 0; j < tr[i].cells.length; j++) {
        td = tr[i].cells[j];
        if (td) {
          txtValue = td.textContent || td.innerText;
          if (txtValue.toUpperCase().indexOf(filter) > -1) {
            rowShouldBeVisible = true;
            break; // If a match is found in this row, no need to check further
          }
        }
      }
      if (rowShouldBeVisible) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }

  }
</script>
{% endblock %}