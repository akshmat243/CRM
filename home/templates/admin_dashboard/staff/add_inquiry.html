{% extends 'admin_dashboard/staff/base.html' %}
{% block content %}
{% load static %}

<div class="form-section">
    <div class="row">
        <div class="card-step">
            <form id="multiStepForm">
                {% csrf_token %}
                <!-- Step 1: Merchant Register Forms -->
                <div class="tab">
                    <div class="formbg-title">Merchant Register Forms</div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="text-label">Merchant Legal Name*</label>
                                <input type="text" name="merchant_legal_name" id="merchant_legal_name" class="form-control" placeholder="Legal Name">
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="text-label">Merchant DBA Name*</label>
                                <input type="text" name="merchant_dba_name" id="merchant_dba_name" class="form-control" placeholder="DBA Name">
                            </div>
                        </div>
                
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="text-label">Installation Address*</label>
                                <textarea name="installation_address" id="installation_address" class="form-control" placeholder="Installation Address"></textarea>
                            </div>
                        </div>
                
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="text-label">City*</label>
                                <input type="text" name="city" id="city" class="form-control" placeholder="City">
                            </div>
                        </div>
                
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="text-label">Pin code*</label>
                                <input type="number" name="pincode" id="pincode" class="form-control" placeholder="Pincode">
                            </div>
                        </div>
                
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="text-label">State*</label>
                                <input type="text" name="state" id="state" class="form-control" placeholder="State">
                            </div>
                        </div>
                
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="text-label">Contact Person Name*</label>
                                <input type="text" name="contact_person_name" id="contact_person_name" class="form-control" placeholder="Contact Person Name">
                            </div>
                        </div>

                
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="text-label">Telephone No.</label>
                                <input type="number" maxlength="10" name="telephone_no" id="telephone_no" class="form-control" placeholder="Telephone No." style="width: 100%;" maxlength="20" required style="width: 100%;"
                                oninput="if(this.value.length > 10) this.value = this.value.slice(0, 10);" min="999999999"
                                max="9999999999" required>
                            </div>
                        </div>
                
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="text-label">Primary Mobile No*</label>
                                <input type="number" name="primary_mobile_no" id="primary_mobile_no" class="form-control" placeholder="Primary Mobile No" style="width: 100%;" maxlength="20" required style="width: 100%;"
                                oninput="if(this.value.length > 10) this.value = this.value.slice(0, 10);" min="999999999"
                                max="9999999999" required>
                            </div>
                        </div>
                
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="text-label">Secondary Mobile No</label>
                                <input type="number"  name="secondary_mobile_no" id="secondary_mobile_no" class="form-control" placeholder="Secondary Mobile No" style="width: 100%;" maxlength="20" required style="width: 100%;"
                                oninput="if(this.value.length > 10) this.value = this.value.slice(0, 10);" min="999999999"
                                max="9999999999" required>
                                
                            </div>
                            
                        </div>
                
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="text-label">Email Address</label>
                                <input type="email" name="email_address" id="email_address" class="form-control" placeholder="Email Address">
                            </div>
                        </div>
                
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="text-label">PAN Number*</label>
                                <input type="text" name="pan_no" id="pan_no" class="form-control" placeholder="PAN Number">
                            </div>
                        </div>
                
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="text-label">GST Number</label>
                                <input type="text" name="gst_no" id="gst_no" class="form-control" placeholder="GST Number">
                            </div>
                        </div>
                
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="text-label">Type of Business*</label>
                                <input type="text" name="type_of_business" id="type_of_business" class="form-control" placeholder="Type of Business">
                            </div>
                        </div>
                
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="text-label">Constitution Type*</label>
                                <select name="constitution_type" id="constitution_type" class="form-control">
                                    <option value="">Select Constitution Type</option>
                                    <option value="sole_proprietorship">Sole Proprietorship</option>
                                    <option value="partnership">Partnership</option>
                                    <option value="public_private_ltd">Public / Pvt Ltd</option>
                                    <option value="govt_establishment">Govt. Establishments</option>
                                    <option value="others">Others</option>
                                </select>
                            </div>
                        </div>
                
                        <div class="col-md-6" id="other_constitution_field">
                            <div class="form-group">
                                <label class="text-label">Other Constitution Type</label>
                                <input type="text" name="other_constitution_type" id="other_constitution_type" class="form-control" placeholder="Other Constitution Type">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Merchant Settlement Details -->
                <div class="tab">
                    <div class="formbg-title">Merchant Settlement Details</div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="text-label">Beneficiary Name*</label>
                                <input type="text" name="beneficiary_name" id="beneficiary_name" class="form-control"
                                    placeholder="Beneficiary Name" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="text-label">Account Number*</label>
                                <input type="number" name="bank_account_no" id="bank_account_no" class="form-control"
                                    placeholder="Account Number" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="text-label">Bank Name*</label>
                                <input type="text" name="bank_name" id="bank_name" class="form-control"
                                    placeholder="Bank Name" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="text-label">IFSC Code*</label>
                                <input type="text" name="ifsc_code" id="ifsc_code" class="form-control"
                                    placeholder="IFSC Code" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="text-label">Branch Name*</label>
                                <input type="text" name="branch_name" id="branch_name" class="form-control"
                                    placeholder="Branch Name" required>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="btnstep">
                    <button type="button" class="btn btn-secondary" id="prevBtn" onclick="navigateTabs(-1)">Previous</button>
                    <button type="button" class="btn btn-primary" id="nextBtn" onclick="navigateTabs(1)">Continue</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        let currentTab = 0; // Initial tab index
        const tabs = document.querySelectorAll(".tab");

        const showTab = (n) => {
            tabs.forEach((tab, index) => {
                tab.style.display = index === n ? "block" : "none";
            });

            document.getElementById("prevBtn").style.display = n === 0 ? "none" : "inline";
            document.getElementById("nextBtn").innerText = n === tabs.length - 1 ? "Submit" : "Continue";
        };

        const navigateTabs = (step) => {
            const inputs = tabs[currentTab].querySelectorAll("input, select");
            let valid = true;

            // Validate current tab inputs
            inputs.forEach((input) => {
                if (!input.checkValidity()) {
                    input.classList.add("is-invalid");
                    valid = false;
                } else {
                    input.classList.remove("is-invalid");
                }
            });

            // If the current tab is invalid, prevent navigation
            if (!valid) return;

            // Hide the current tab
            tabs[currentTab].style.display = "none";

            // Update current tab index
            currentTab += step;

            // If no more tabs, submit the form
            if (currentTab >= tabs.length) {
                submitForm();
                return;
            }

            // Show the next/previous tab
            showTab(currentTab);
        };

        const submitForm = () => {
            const formData = new FormData(document.getElementById("multiStepForm"));

            fetch("{% url 'add_inquiry' %}", {
                method: "POST",
                body: formData,
                headers: {
                    "X-CSRFToken": "{{ csrf_token }}"
                },
            })
                .then((response) => response.json())
                .then((data) => {
                    if (data.success) {
                        // Redirect to staff_user page after successful submission
                        window.location.href = "{% url 'staff_user' %}";
                    } else {
                        alert("There was an error submitting the form.");
                    }
                })
                .catch((error) => {
                    console.error("Error:", error);
                    alert("Submission failed.");
                });
        };

        // Initialize the form with the first tab visible
        showTab(currentTab);

        // Attach event listeners to buttons
        document.getElementById("prevBtn").addEventListener("click", () => navigateTabs(-1));
        document.getElementById("nextBtn").addEventListener("click", () => navigateTabs(1));
    });
</script>




<div class="modal-form-marchant modal fade" id="onload" tabindex="-1" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Merchant Detail</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="merchantDetailsForm">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label for="">Full Name</label>
                                <input type="text" placeholder="Full Name" class="form-control" id="full_name">
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label for="">Contact Number</label>
                                <input type="number" placeholder="Contact Number" class="form-control"
                                    id="contact_number" style="width: 100%;" maxlength="20" required style="width: 100%;"
                                    oninput="if(this.value.length > 10) this.value = this.value.slice(0, 10);" min="999999999"
                                    max="9999999999" required>
                            </div>
                        </div>
                        <div class="col-sm-12">
                            <div class="form-group">
                                <label for="">Address</label>
                                <textarea class="form-control" id="address"></textarea>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-check custom-check">
                                <input id="Intrested" class="form-check-input" type="checkbox">
                                <label class="form-check-label" for="Intrested">
                                    Interested
                                </label>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-check custom-check">
                                <input id="NotIntrested" class="form-check-input" type="checkbox">
                                <label class="form-check-label" for="NotIntrested">
                                    Not Interested
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Hidden form fields to be shown only when "Interested" or "Not Interested" is selected -->
                    <div id="formFields" style="display: none;">
                        <div class="form-group">
                            <button type="button" id="submitMerchantDetails" class="btn btn-primary">Submit</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


</div>
</div>
</div>
</div>




<script src="js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>


<script type="text/javascript">
    window.onload = () => {
        $('#onload').modal('show');
    }
</script>

<script>
    $(document).ready(function () {
        // Flag to check if all forms are ready for submission
        let formsSubmitted = false;

        // Event listener for the "Interested" checkbox
        $('#Intrested').on('change', function () {
            if ($(this).is(':checked')) {
                // Hide the modal
                $('#onload').modal('hide');

                // Show the Merchant Registration form sections
                $('.form-section').fadeIn();
            } else {
                // Hide the Merchant Register form if unchecked
                $('.form-section').fadeOut();

                // Optionally show the modal again if needed
                $('#onload').modal('show');
            }
        });

        // Get CSRF token from the DOM (assuming it's available in the template)
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

        // Event listener for the "Not Interested" checkbox
    });
$('#NotIntrested').on('change', function () {
    if ($(this).is(':checked')) {
        // Collect form field data
        let fullName = $('#full_name').val();
        let contactNumber = $('#contact_number').val();
        let address = $('#address').val();
        let status = 'Not Interested';

        // Check if all fields are filled before sending the request
        if (fullName && contactNumber && address) {
            // Perform the AJAX call
            $.ajax({
                url: '{% url "interested-not-interested-inquiry" %}', // Replace with your server-side endpoint
                method: 'POST',
                data: {
                    full_name: fullName,
                    contact_number: contactNumber,
                    address: address,
                    status: status,
                    csrfmiddlewaretoken: '{{ csrf_token }}' // Include CSRF token if needed
                },
                success: function (response) {
                    // Handle the successful response
                    if (response.success) {
                        window.location.href = '/staff_user'; 
                    }
                },
                error: function (error) {
                    // Handle any errors
                    alert('An error occurred while processing your request.');
                }
            });
        } else {
            // Alert the user to fill in the required fields
            alert('Please fill in all required fields (Full Name, Contact Number, and Address).');
        }
    }
});
$('#Intrested').on('click', function () {
    // Gather modal form data
    let fullName = $('#full_name').val();
    let contactNumber = $('#contact_number').val();
    let address = $('#address').val();
    let status = 'Interested';
    // Check if modal fields are empty
    if (!fullName || !contactNumber || !address) {
        alert('Please fill in all required fields in the modal form.');
        return; // Stop further execution if any field is empty
    }

    // Prepare the data for the AJAX call
    let formData = {
        full_name: fullName,
        contact_number: contactNumber,
        address: address,
        status :  status,
        isInterested: $(this).is(':checked') ? 'Interested' : 'Not Interested', // Determine if checked
        csrfmiddlewaretoken: $('input[name="csrfmiddlewaretoken"]').val() // Get CSRF token
    };

    // Make the AJAX request
    $.ajax({
        url: '{% url "interested-not-interested-inquiry" %}', // Your backend URL
        method: 'POST',
        data: formData, // Send the form data
        success: function (response) {
            if (response.success) {
                
            } else {
                alert('There was an issue with your submission. Please try again.');
            }
        },
        error: function (error) {
            console.error('Error:', error);
            alert('An error occurred. Please try again later.');
        }
    });
});


</script>



</body>


</html>

{% endblock %}