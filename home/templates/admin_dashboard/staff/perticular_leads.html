{% extends request.user.is_superuser|yesno:'base.html,admin_dashboard/base.html' %}
{% block content %}
{% load static %}


<style>
  /* Ensure select dropdowns fit within the screen */
  select.form-select-sm {
      max-width: 100%;
      overflow-x: hidden;
  }

  /* Optional: Adjust the font size for select options on mobile */
  @media (max-width: 575px) {
      select.form-select-sm {
          font-size: 14px;
      }
  }
</style>

<div class="dashboard-main-body">
  <div class="dash-title">Staff Leads</div>



<div class="pb-3">
  <form method="post" action="{% url 'export_leads_status_wise_staff' %}">
    {% csrf_token %}
      <!-- Start Date -->
       <input type="text" name="staff_id" value="{{ staff_id }}" hidden>
       <div class="row">
      <div class="col-md-3 col-sm-12">
          <input type="date" class="form-control form-control-sm" id="startDate" name="start_date" required>
      </div>
      <!-- End Date -->
      <div class="col-md-3 col-sm-12">
          <input type="date" class="form-control form-control-sm" id="endDate" name="end_date" required>
      </div>
      <!-- Status -->
      <div class="col-md-3 col-sm-12">
          <select class="form-select form-select-sm" id="status" name="status" required>
            <option selected>Open this select menu</option>
            <option value="Leads">Leads</option>
            <option value="Intrested">Intrested</option>
            <option value="Not Interested">Not Interested</option>
            <option value="Other Location">Other Location</option>
            <option value="Not Picked">Not Picked</option>
            <option value="Lost">Lost</option>
            <option value="Visit">Visit</option>
          </select>
      </div>
      <!-- Export Button -->
      <div class="col-lg-2 col-md-3 col-sm-12">
          <button type="submit" class="btn btn-sm w-100">Export</button>
      </div>
    </div>
  </form>
</div>

  
<div class="card h-100 p-0 radius-12">
  
    <div class="card-header border-bottom row">
      <div class="col-lg-3 col-md-6 col-sm-12">
            <form class="navbar-search">
                <input type="text" id="searchInput" class="bg-base h-40-px w-100" name="search"
                    placeholder="Search" onkeyup="searchTable()">
                <iconify-icon icon="ion:search-outline" class="icon"></iconify-icon>
            </form>
      </div>
      <div class="col-lg-3 col-md-6 col-sm-12">
          <select class="form-select form-select-sm w-100" aria-label=".form-select-sm example" onchange="navigateToUrl(this)">
            <option selected>Select Type</option>
            <option value="{% url 'leam_lead_show' staff_id 'Intrested' %}">Intrested</option>
            <option value="{% url 'leam_lead_show' staff_id 'Not Interested' %}">Not Interested</option>
            <option value="{% url 'leam_lead_show' staff_id 'Other Location' %}">Other Location</option>
            <option value="{% url 'leam_lead_show' staff_id 'Lost' %}">Lost</option>
            <option value="{% url 'leam_lead_show' staff_id 'Visit' %}">Visit</option>
        </select>
      </div>
    </div>

  

      <div class="card-body p-24">
        <div class="table-responsive scroll-sm">
          <table class="table bordered-table sm-table mb-0" id="myTable">
            <thead>
              <tr>
                <th>S.N.</th>
                <th>Name</th>
                <th>staff</th>
                <th>Status</th>
                <!-- <th>E-mail</th> -->
                <th>Call</th>
                <th class="text-center">Whatsapp</th>
                <th>Date & Time</th>
                
              </tr>
            </thead>
            <tbody>
              <tbody>
                {% for log in page %}
                <tr>
                  <td>{{ forloop.counter}}</td>
                  <td>{{ log.name }}</td>
                  <td>{{ log.assigned_to.name }}</td>
                  <td>{{ log.status }}</td>
                  <!-- <td>{{ log.email }}</td> -->
                  <td>
                    <a href="tel:{{ log.call }}">
     
                        <i class="fas fa-phone" style="font-size:1.1em; transform: rotate(95deg);"></i></a>
                </td>
                <td class="text-center">
                    <a href="https://wa.me/{{ log.call }}?text=Hello%20{{ user.name }}" target="_blank">
                        <i class="fab fa-whatsapp menu-icon" style="font-size:1.5em; color: #25D366;"></i>
                    </a>
                </td>
                <td>{{ log.updated_date }}</td>
                
                  </tr>
                  {% endfor %}
              </tbody>
          </table>
        </div>
        <nav class="mt-3" aria-label="Page navigation example">
          <ul class="pagination">
              <!-- First page link -->
              <li class="page-item {% if not page.has_previous %}disabled{% endif %}">
                  <a class="page-link" href="?page=1" aria-label="First">
                      <span aria-hidden="true">&laquo;</span>
                  </a>
              </li>
      
              <!-- Previous page link -->
              {% if page.has_previous %}
                  <li class="page-item">
                      <a class="page-link" href="?page={{ page.previous_page_number }}" aria-label="Previous">
                          <span aria-hidden="true">&lsaquo;</span>
                      </a>
                  </li>
              {% endif %}
      
              <!-- Page numbers -->
              {% for num in page_range %}
                  {% if num == '...' %}
                      <li class="page-item disabled"><a class="page-link">...</a></li>
                  {% else %}
                      <li class="page-item {% if num == page.number %}active{% endif %}">
                          <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                      </li>
                  {% endif %}
              {% endfor %}
      
              <!-- Next page link -->
              {% if page.has_next %}
                  <li class="page-item">
                      <a class="page-link" href="?page={{ page.next_page_number }}" aria-label="Next">
                          <span aria-hidden="true">&rsaquo;</span>
                      </a>
                  </li>
              {% endif %}
      
              <!-- Last page link -->
              <li class="page-item {% if not page.has_next %}disabled{% endif %}">
                  <a class="page-link" href="?page={{ page.paginator.num_pages }}" aria-label="Last">
                      <span aria-hidden="true">&raquo;</span>
                  </a>
              </li>
          </ul>
      </nav>
      </div>

    </div>

    </div>
  </div>
</div>

<script>
  function navigateToUrl(selectElement) {
      var selectedValue = selectElement.value;
      if (selectedValue) {
          window.location.href = selectedValue;
      }
  }
</script>

<script>
  function searchTable() {
    var input, filter, table, tr, td, i, txtValue;
    input = document.getElementById("searchInput");
    filter = input.value.toUpperCase();
    table = document.getElementById("myTable");
    tr = table.getElementsByTagName("tr");

    // Loop through all table rows, and hide those that don't match the search query
    for (i = 0; i < tr.length; i++) {
      var rowShouldBeVisible = false;

      // Loop through all cells of current row
      for (j = 0; j < tr[i].cells.length; j++) {
        td = tr[i].cells[j];
        if (td) {
          txtValue = td.textContent || td.innerText;
          if (txtValue.toUpperCase().indexOf(filter) > -1) {
            rowShouldBeVisible = true;
            break; // If a match is found in this row, no need to check further
          }
        }
      }
      if (rowShouldBeVisible) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }

  }

  function showInputRows() {
    const input = document.getElementById("rowInput").value;
    const count = parseInt(input) || 'all';
    showRows(count);
  }

  function showRows(count) {
    const rows = document.querySelectorAll("#myTable tbody tr");
    rows.forEach((row, index) => {
      if (count === 'all' || index < count) {
        row.style.display = "";
      } else {
        row.style.display = "none";
      }
    });
  }

  function toggleRow(button) {
    var row = button.parentNode.parentNode;
    if (row.classList.contains('selected')) {
      row.classList.remove('selected');
      button.style.backgroundColor = 'white';
    } else {
      row.classList.add('selected');
      button.style.backgroundColor = 'black';
    }
  }

  function toggleAllRows() {
    var buttons = document.querySelectorAll('.select-button');
    var allSelected = true;
    buttons.forEach(function (button) {
      var row = button.parentNode.parentNode;
      if (!row.classList.contains('selected')) {
        allSelected = false;
      }
    });

    buttons.forEach(function (button) {
      var row = button.parentNode.parentNode;
      if (allSelected) {
        row.classList.remove('selected');
        button.style.backgroundColor = 'white';
      } else {
        row.classList.add('selected');
        button.style.backgroundColor = 'black';
      }
    });
  }

</script>

{% endblock %}