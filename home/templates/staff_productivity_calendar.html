{% extends template %}

{% block content %}
{% load static %}
{% load custom_tags %}
{% load custom_filters %}

<head>
    <style>
        /* Custom styles for mobile responsiveness */
        @media (max-width: 768px) {
            /* .table thead {
                display: none;
            } */
            .table>:not(caption)>*>* {
               padding: .0rem .0rem !important;
            }

            .table tbody td {
                display: block;
                width: 100%;
                text-align: right;
                /* padding-left: 50%; */
                position: relative;
            }

            .table tbody .d-md-content{
                display: none !important;
            }

            .table tbody td::before {
                content: attr(data-label);
                position: absolute;
                left: 0;
                width: 50%;
                padding-left: 15px;
                font-weight: bold;
                text-align: left;
                white-space: nowrap;
            }
        }

        .,
        .bg-primary,
        .bg-success {
            font-size: 0.9rem;
        }

        . .fw-bold,
        .bg-primary .fw-bold,
        .bg-success .fw-bold {
            font-size: 1.2rem;
        }
    </style>
</head>

<body>
    <div class="dashboard-main-body">
        <div class="dash-title">Earn Calendar</div>

        <form method="get" class="row mb-3 pb-1">
            <div class="col-md-3 col-sm-12">
                <select name="month" id="month" class="form-select">
                    {% for number, month_name in months_list %}
                        <option value="{{ number }}" {% if number == month %}selected{% endif %}>{{ month_name }}</option>
                    {% endfor %}
                </select>
                
            </div>
            <div class="col-md-3 col-sm-12">
                <input type="number" id="year" name="year" class="form-control" value="{{ year }}">
            </div>
            <div class="col-lg-2 col-md-3 col-sm-12">
                <button type="submit" class="btn w-100">Filter</button>
            </div>
        </form>
        
    
        <div class="table-responsive">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <div>
                        <td class="bg-info px-4 text-center   d-flex d-md-none" style="border-bottom: 1px solid white;">
                            <div class="col-2 py-2" style="border-right: 1px solid white;">Date</div>
                            <div class="col-2 py-2" style="border-right: 1px solid white;">Day</div>
                            
                            <div class="col-4 py-2" style="border-right: 1px solid white;">Status</div>
                            <div class="col-4 py-2">Earn</div>
                        </td>
                    </div>
                    </tr>
                </thead>
                <tbody class="">
                    {% for week in structured_calendar_data %}
                    <tr>
                        {% for day in week %}
                        {% if day.day == 0 %}
                        <td class="bg-white"></td>  <!-- Empty day cell with white background -->
                        {% else %}
                        {% with day_productivity=productivity_data|get_item:day.day %}
                        
                        {% if day_productivity.leads|default:0 < 10 %}
                        <td class="  d-md-content" data-label="{{ day.day_name }}">
                            <div class="text-success fs-30">{{ day.day }}</div>
                            <div class="text-info fs-20 d-none d-md-block">{{ day.day_name|slice:":3" }}</div>
                            
                            <div class="fs-14">Leads: {{ day_productivity.leads|default:0 }}</div>
                            <div class="fs-14">Earn: ₹{{ day_productivity.salary|default:0 }}</div>
                        </td>
                        <!-- mobile view  -->
                        <td class=" px-4 text-center  d-flex d-md-none" style="border-bottom: 1px solid white;">
                            <div class="col-2 py-2" style="border-right: 1px solid white;">{{ day.day }}</div>
                            <div class="col-2 py-2" style="border-right: 1px solid white;">{{ day.day_name|slice:":3" }}</div>
                            
                            <div class="col-4 py-2" style="border-right: 1px solid white;">Leads: {{ day_productivity.leads|default:0 }}</div>
                            <div class="col-4 py-2" style="border-right: 1px solid white;">Earn: ₹{{ day_productivity.salary|default:0 }}</div>
                        </td>
                        
                        {% elif day_productivity.leads >= 10 and day_productivity.leads <= 14 %}
                        <td class="bg-primary  d-md-content" data-label="{{ day.day_name }}">
                            <div class="text-success fs-30">{{ day.day }}</div>
                            <div class="text-info fs-20 d-none d-md-block">{{ day.day_name|slice:":3" }}</div>
                            <div class="fs-14">Leads: {{ day_productivity.leads|default:0 }}</div>
                            <div class="fs-14">Earn: ₹{{ day_productivity.salary|default:0 }}</div>
                        </td>
                         <!-- mobile view  -->
                         <td class="bg-primary text-center px-4  d-flex d-md-none" style="border-bottom: 1px solid white;">
                            <div class="col-2"style="border-right: 1px solid white;">{{ day.day }}</div>
                            <div class="col-2" style="border-right: 1px solid white;">{{ day.day_name|slice:":3" }}</div>
                            <div class="col-4" style="border-right: 1px solid white;">Leads: {{ day_productivity.leads|default:0 }}</div>
                            <div class="col-4" style="border-right: 1px solid white;">Earn: ₹{{ day_productivity.salary|default:0 }}</div>
                        </td>
                        
                        {% elif day_productivity.leads|default:0 >= 15 %}
                        <td class="bg-success " data-label="{{ day.day_name }}">
                            <div class="text-success fs-30">{{ day.day }}</div>
                            <div class="text-info fs-20 d-none d-md-block">{{ day.day_name|slice:":3" }}</div>
                            <div class="fs-14">Leads: {{ day_productivity.leads|default:0 }}</div>
                            <div class="fs-14">Earn: ₹{{ day_productivity.salary|default:0 }}</div>
                        </td>
                         <!-- mobile view  -->
                         <td class="bg-success text-center px-4  d-flex d-md-none" style="border-bottom: 1px solid white;">
                            <div class="col-2" style="border-right: 1px solid white;">{{ day.day }}</div>
                            <div class="col-2" style="border-right: 1px solid white;">{{ day.day_name|slice:":3" }}</div>
                            <div class="col-4" style="border-right: 1px solid white;">Leads: {{ day_productivity.leads|default:0 }}</div>
                            <div class="col-4" style="border-right: 1px solid white;">Earn: ₹{{ day_productivity.salary|default:0 }}</div>
                        </td>
                        
                        {% endif %}
                        {% endwith %}
                        {% endif %}
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    
        <div class="mt-3 d-flex justify-content-between">
            <div>
                <h6>Monthly Salary: ₹{{ monthly_salary }}</h6>
            </div>
            <div>
                <h6>Earn Salary: ₹{{ total_salary }}</h6>
            </div>
        </div>

    </div>
</body>

{% endblock %}





<!-- <tbody>
            <tr>
                <td>Day</td>
                {% for day in days_list %}
                    <td>{{ day }}</td>
                {% endfor %}
            </tr>
            <tr>
                <td>Leads</td>
                {% for day in days_list %}
                    <td>
                        {% with day_productivity=productivity_data|get_item:day %}
                            <div>{{ day_productivity.leads|default:0 }}</div>
                        {% endwith %}
                    </td>
                {% endfor %}
            </tr>
            <tr>
                <td>Salary</td>
                {% for day in days_list %}
                    <td>
                        {% with day_productivity=productivity_data|get_item:day %}
                            <div>₹{{ day_productivity.salary|default:0 }}</div>
                        {% endwith %}
                    </td>
                {% endfor %}
            </tr>
        </tbody> -->

<!-- ------------------------------------------------------------------------------------- -->
        <!-- table for format calender -->

        <!-- <div class="container mt-4">
            <h2>Productivity Calendar for {{ staff.name }}</h2>
            <form method="get" class="row mb-4">
                <div class="col-md-3">
                    <label for="month" class="form-label">Month</label>
                    <select name="month" id="month">
                        {% for month in months_list %}
                            <option value="{{ month }}">{{ month }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="year" class="form-label">Year</label>
                    <input type="number" id="year" name="year" class="form-control" value="{{ year }}">
                </div>
                <div class="col-md-3 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary">Filter</button>
                </div>
            </form>
            <table class="table table-bordered table-responsive">
                <thead>
                    <tr>
                        <th>Sun</th>
                        <th>Mon</th>
                        <th>Tue</th>
                        <th>Wed</th>
                        <th>Thu</th>
                        <th>Fri</th>
                        <th>Sat</th>
                    </tr>
                </thead>
        
                <tbody>
                    {% for week in calendar_data %}
                    <tr>
                        {% for day in week %}
                        <td>
                            {% if day != 0 %}
                                <div>{{ day }}</div>
                                {% with day_productivity=productivity_data|get_item:day %}
                                    <div>Leads: {{ day_productivity.leads|default:0 }}</div>
                                    <div>Salary: ₹{{ day_productivity.salary|default:0 }}</div>
                                {% endwith %}
                            {% endif %}
                        </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            
            
            <div>
                <h4>Total Salary for the Month: ₹{{ total_salary }}</h4>
            </div>
        </div> -->